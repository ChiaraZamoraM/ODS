---
title: "Observatorio de la Escuela de Gestión Pública"
output: 
  flexdashboard::flex_dashboard:
    orientation: columns
    vertical_layout: fill
---

<style>                     
.navbar {
  background-color:#34282C;
  border-color:#34282C;
}
.navbar-brand {
color:white!important;
}
</style>   

```{r setup, include=FALSE}
library(flexdashboard)
library(ggplot2)
library(ggpubr)
library(ggrepel)
library(tidyverse)
library(repr)
library(quantmod)
library(rio)
library(plotly)
library(scales)
library(tidyr)
library(gridExtra)
```

```{r plotsCode_ACTUAL, warning=FALSE, message=FALSE}
library(lubridate)
library(viridis)
ODSSpr = import("https://github.com/ChiaraZamoraM/ODS/raw/main/ODSSpr.RDS")
ODSSpr$Ano = as.Date(as.character(ODSSpr$Ano), format = "%Y")
ODSSpr$Ano = year(ODSSpr$Ano)
```

```{r plotsCode_ACTUAL, warning=FALSE, message=FALSE}
Area = subset(ODSSpr, DEPARTAMENTO == "Total" | DEPARTAMENTO == "Urbana" | 
                    DEPARTAMENTO == "Rural")

Area$DEPARTAMENTO = factor(Area$DEPARTAMENTO, levels = c("Total",
                                                         "Urbana",
                                                         "Rural"))
```

```{r plotsCode_ACTUAL, warning=FALSE, message=FALSE}
Regiones = subset(ODSSpr, DEPARTAMENTO == "Costa"|
                    DEPARTAMENTO == "Sierra"| 
                    DEPARTAMENTO == "Selva"|
                    DEPARTAMENTO == "Lima Metropolitana")

Regiones$DEPARTAMENTO = factor(Regiones$DEPARTAMENTO, levels = c("Costa", "Sierra",
                                                                 "Selva", "Lima Metropolitana"))
```

```{r plotsCode_ACTUAL, warning=FALSE, message=FALSE}
Departamentos = subset(ODSSpr, DEPARTAMENTO == "Amazonas" | DEPARTAMENTO == "Áncash" | 
                    DEPARTAMENTO == "Apurímac" | 
                    DEPARTAMENTO == "Arequipa"| 
                    DEPARTAMENTO == "Ayacucho"| 
                    DEPARTAMENTO == "Cajamarca"|
                    DEPARTAMENTO == "Callao"|
                    DEPARTAMENTO == "Huancavelica"|
                    DEPARTAMENTO == "Huánuco"|
                    DEPARTAMENTO == "Ica"|
                    DEPARTAMENTO == "Loreto"|
                    DEPARTAMENTO == "Madre de Dios"|
                    DEPARTAMENTO == "Pasco"|
                    DEPARTAMENTO == "Piura"|
                    DEPARTAMENTO == "Provincias de Lima"|
                    DEPARTAMENTO == "Puno"|
                    DEPARTAMENTO == "San Martín"|
                    DEPARTAMENTO == "Tacna"|
                    DEPARTAMENTO == "Tumbes"|
                    DEPARTAMENTO == "Ucayali")
```

```{r plotsCode_ACTUAL, warning=FALSE, message=FALSE}
startTime = as.Date(as.character("2010"), format = "%Y")
#startTime <- as.Date("2010")
endTime = as.Date(as.character("2020"), format = "%Y")

start.end <- c(startTime,endTime)
```

```{r plotsCode_ACTUAL, warning=FALSE, message=FALSE}
#ODS 1.1.1

ODS1_1_1= Regiones[c(1:3)]
  
colnames(ODS1_1_1)= c("Área","Año","Avance")
ODS1_1_1= ODS1_1_1[!is.na(ODS1_1_1$Avance),]

plot1 = ggplotly(ggplot(ODS1_1_1, aes(x=Año, y=Avance, colour=Área)) +
                   geom_line()+
                   theme_light() +
                   labs(x= "Años", y = "Porcentaje", colour = "Área/Dpto."))

ODS1_1_1_D= Departamentos[c(1:3)]
colnames(ODS1_1_1_D)= c("Área","Año","Avance")

ODS1_1_1_D= ODS1_1_1_D[!is.na(ODS1_1_1_D$Avance),]

plot1.1 = ggplotly(ggplot(ODS1_1_1_D, aes(x=Año, y=Avance, colour=Área))+
                     geom_line() +
                     theme_light() +
                     labs(x= "Años", y = "Porcentaje", colour = "Área/Dpto."))
```

```{r plotsCode_ACTUAL, warning=FALSE, message=FALSE}
#ODS 1.2.1

## plot2
ODS1_2_1= Area[c(1,2,4)]
  
colnames(ODS1_2_1)= c("Área","Año","Avance")
ODS1_2_1 = ODS1_2_1[!is.na(ODS1_2_1$Avance),]

plot2 = ggplotly(ggplot(ODS1_2_1, aes(x=Año, y=Avance, fill=Área))+
                   geom_bar(stat="identity", position=position_dodge())+
                   theme_light() +
                   scale_fill_viridis(discrete = TRUE,option = "magma")+
                   labs(x= "Años", y = "Porcentaje", colour = "Área/Dpto."))

## plot2.1
ODS1_2_1_R= Regiones[c(1,2,4)]
  
colnames(ODS1_2_1_R)= c("Área","Año","Avance")
ODS1_2_1_R = ODS1_2_1_R[!is.na(ODS1_2_1_R$Avance),]

plot2.1 = ggplotly(ggplot(ODS1_2_1_R, aes(x=Año, y=Avance, fill=Área))+
                   geom_bar(stat="identity", position=position_dodge())+
                   theme_light() +
                   scale_fill_viridis(discrete = TRUE)+
                   labs(x= "Años", y = "Porcentaje", colour = "Área/Dpto."))

## plot2.2
ODS1_2_1_D= Departamentos[c(1,2,4)]
  
colnames(ODS1_2_1_D)= c("Área","Año","Avance")
ODS1_2_1_D= ODS1_2_1_D[!is.na(ODS1_2_1_D$Avance),]

plot2.2 = ggplotly(ggplot(ODS1_2_1_D, aes(x=Año, y=Avance, colour=Área))+
                     geom_line()+ 
                     theme_light() +
                     labs(x= "Años", y = "Porcentaje", colour = "Área/Dpto."))

```

**ODS 1** 
=====================================

Column {data-width=120}
-------------------------------------
    
### **Fin de la pobreza** 

Elaborado por el Observatorio de Políticas Públicas.

Column {.tabset}
-------------------------------------

### **1.1.1**

```{r, fig.height = 5, fig.width = 8, fig.align = "center"}
titulo = "1.1.1 Incidencia de la pobreza extrema"

subplot(subplot(plot2, plot2.1), plot2.2, nrows = 2) %>% layout(title = titulo)
```
