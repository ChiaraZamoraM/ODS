---
title: "Procesamiento de indicadores de ODS"
output: html_notebook
---

```{r, warning=FALSE, message=FALSE}
#Lima es Lima Metropolitana + Provincias de Lima/Departamento de Lima
```

```{r, warning=FALSE, message=FALSE}
library(readxl)
library(rio)
library(reshape2)
library(stringi)
library(tidyverse)
library(lubridate)
```

# ODS 1

## 1.1.1 Incidencia de la pobreza extrema
```{r, warning=FALSE, message=FALSE}
url <- "https://github.com/ChiaraZamoraM/ODS/raw/main/1.1.1.xlsx"
destfile <- "X1_1_1.xlsx"
curl::curl_download(url, destfile)
X1_1_1 <- read_excel(destfile, skip = 28)

colnames(X1_1_1) = paste0("ODS1_1_1_",colnames(X1_1_1))

X1_1_1 = X1_1_1[,c(1,10:26)]
```

```{r, warning=FALSE, message=FALSE}
X1_1_1[,c(2:18)]=lapply(X1_1_1[,c(2:18)], as.numeric)

X1_1_1$ODS1_1_1_2013= (X1_1_1$ODS1_1_1_2013+ X1_1_1$ODS1_1_1_...12)/2
X1_1_1$ODS1_1_1_2014= (X1_1_1$ODS1_1_1_2014+ X1_1_1$ODS1_1_1_...14)/2
X1_1_1$ODS1_1_1_2015= (X1_1_1$ODS1_1_1_2015+ X1_1_1$ODS1_1_1_...16)/2
X1_1_1$ODS1_1_1_2016= (X1_1_1$ODS1_1_1_2016+ X1_1_1$ODS1_1_1_...18)/2
X1_1_1$ODS1_1_1_2017= (X1_1_1$ODS1_1_1_2017+ X1_1_1$ODS1_1_1_...20)/2
X1_1_1$ODS1_1_1_2018= (X1_1_1$ODS1_1_1_2018+ X1_1_1$ODS1_1_1_...22)/2
X1_1_1$ODS1_1_1_2019= (X1_1_1$ODS1_1_1_2019+ X1_1_1$ODS1_1_1_...24)/2
X1_1_1$ODS1_1_1_2020= (X1_1_1$ODS1_1_1_2020+ X1_1_1$ODS1_1_1_...26)/2

names(X1_1_1)[1]= "DEPARTAMENTO"

X1_1_1$DEPARTAMENTO= gsub("^Lima$","Provincias de Lima",X1_1_1$DEPARTAMENTO)

X1_1_1 <- data.frame(X1_1_1[,seq(1,18,2)])
```

```{r, warning=FALSE, message=FALSE}
X1_1_1_R <- import("https://www.inei.gob.pe/media/MenuRecursivo/publicaciones_digitales/Est/Lib1829/cap09/cap09002.xlsx")
names(X1_1_1_R) <- as.character(X1_1_1_R[3,])
X1_1_1_R = X1_1_1_R[-c(1:6),c(1:13)]
colnames(X1_1_1_R) = paste0("ODS1_1_1_",colnames(X1_1_1_R))
names(X1_1_1_R)[1]= "DEPARTAMENTO"

X1_1_1_R$DEPARTAMENTO =gsub(' [0-9].', '', X1_1_1_R$DEPARTAMENTO)
```

```{r, warning=FALSE, message=FALSE}
X1_1_1= merge(X1_1_1_R, X1_1_1, all = TRUE)
X1_1_1=X1_1_1[-23,]
X1_1_1=X1_1_1[rowSums(is.na(X1_1_1)) != ncol(X1_1_1)-1,]
```

## 1.2.1 Incidencia de la pobreza monetaria total

```{r, warning=FALSE, message=FALSE}
url <- "https://github.com/ChiaraZamoraM/ODS/raw/main/1.2.1.xlsx"
destfile <- "X1_2_1.xlsx"
curl::curl_download(url, destfile)
X1_2_1 <- read_excel(destfile, skip = 28)

colnames(X1_2_1) = paste0("ODS1_2_1_",colnames(X1_2_1))

X1_2_1 = X1_2_1[,c(1,16:32)]
```

```{r, warning=FALSE, message=FALSE}
X1_2_1[,c(2:18)]=lapply(X1_2_1[,c(2:18)], as.numeric)
```

```{r, warning=FALSE, message=FALSE}
X1_2_1$ODS1_2_1_2013= (X1_2_1$ODS1_2_1_2013+ X1_2_1$ODS1_2_1_...18)/2
X1_2_1$ODS1_2_1_2014= (X1_2_1$ODS1_2_1_2014+ X1_2_1$ODS1_2_1_...20)/2
X1_2_1$ODS1_2_1_2015= (X1_2_1$ODS1_2_1_2015+ X1_2_1$ODS1_2_1_...22)/2
X1_2_1$ODS1_2_1_2016= (X1_2_1$ODS1_2_1_2016+ X1_2_1$ODS1_2_1_...24)/2
X1_2_1$ODS1_2_1_2017= (X1_2_1$ODS1_2_1_2017+ X1_2_1$ODS1_2_1_...26)/2
X1_2_1$ODS1_2_1_2018= (X1_2_1$ODS1_2_1_2018+ X1_2_1$ODS1_2_1_...28)/2
X1_2_1$ODS1_2_1_2019= (X1_2_1$ODS1_2_1_2019+ X1_2_1$ODS1_2_1_...30)/2
X1_2_1$ODS1_2_1_2020= (X1_2_1$ODS1_2_1_2020+ X1_2_1$ODS1_2_1_...32)/2
names(X1_2_1)[1]= "DEPARTAMENTO"

X1_2_1$DEPARTAMENTO= gsub("^Lima$","Provincias de Lima",X1_2_1$DEPARTAMENTO)

X1_2_1 <- data.frame(X1_2_1[,seq(1,18,2)])
```

```{r, warning=FALSE, message=FALSE}
X1_2_1_R <- import("https://www.inei.gob.pe/media/MenuRecursivo/publicaciones_digitales/Est/Lib1829/cap09/cap09001.xlsx")
names(X1_2_1_R) <- X1_2_1_R[5,]
X1_2_1_R = X1_2_1_R[-c(1:9),c(1:13)]
colnames(X1_2_1_R) = paste0("ODS1_2_1_",colnames(X1_2_1_R))
names(X1_2_1_R)[1]= "DEPARTAMENTO"

X1_2_1_R$DEPARTAMENTO =gsub(' [0-9].', '', X1_2_1_R$DEPARTAMENTO)
```

```{r, warning=FALSE, message=FALSE}
X1_2_1= merge(X1_2_1_R, X1_2_1, all = TRUE)
X1_2_1=X1_2_1[-24,]
X1_2_1=X1_2_1[rowSums(is.na(X1_2_1)) != ncol(X1_2_1)-1,]
```

## 1.3.1 Proporción de población de 14 a más años de edad con seguro de pensión
```{r, warning=FALSE, message=FALSE}
url <- "https://github.com/ChiaraZamoraM/ODS/raw/main/1.3.1.xlsx"
destfile <- "X1_3_1.xlsx"
curl::curl_download(url, destfile)
X1_3_1 <- read_excel(destfile, skip = 7)

colnames(X1_3_1) = paste0("ODS1_3_1_",colnames(X1_3_1))
```

```{r, warning=FALSE, message=FALSE}
X1_3_1[,c(2:14)]=lapply(X1_3_1[,c(2:14)], as.numeric)

names(X1_3_1)[1]= "DEPARTAMENTO"
```

```{r, warning=FALSE, message=FALSE}
X1_3_1$DEPARTAMENTO= gsub("Prov. Const. del Callao","Callao",X1_3_1$DEPARTAMENTO)
#X1_3_1$DEPARTAMENTO= gsub("Provincia de Lima","Lima Metropolitana",X1_3_1$DEPARTAMENTO)
X1_3_1$DEPARTAMENTO= gsub("Región Lima","Provincias de Lima",X1_3_1$DEPARTAMENTO)
X1_3_1$DEPARTAMENTO= gsub("Nacional","Total",X1_3_1$DEPARTAMENTO)
X1_3_1$DEPARTAMENTO= gsub("Resto país","Resto País",X1_3_1$DEPARTAMENTO)
#Resto país y total/nacional
```

## 1.4.1 Proporción de la población que vive en hogares con acceso a servicios básicos de infraestructura
```{r, warning=FALSE, message=FALSE}
url <- "https://github.com/ChiaraZamoraM/ODS/raw/main/1.4.1.xlsx"
destfile <- "X1_4_1.xlsx"
curl::curl_download(url, destfile)
X1_4_1 <- read_excel(destfile, skip = 7)

colnames(X1_4_1) = paste0("ODS1_4_1_",colnames(X1_4_1))
```

```{r, warning=FALSE, message=FALSE}
X1_4_1[,c(2:8)]=lapply(X1_4_1[,c(2:8)], as.numeric)

names(X1_4_1)[1]= "DEPARTAMENTO"
```

```{r, warning=FALSE, message=FALSE}
X1_4_1$DEPARTAMENTO= gsub("Prov. Const. del Callao","Callao",X1_4_1$DEPARTAMENTO)
X1_4_1$DEPARTAMENTO= gsub("Provincia de Lima","Lima Metropolitana",X1_4_1$DEPARTAMENTO)
X1_4_1$DEPARTAMENTO= gsub("Región Lima","Provincias de Lima",X1_4_1$DEPARTAMENTO)
X1_4_1$DEPARTAMENTO= gsub("Nacional","Total",X1_4_1$DEPARTAMENTO)
```

## Merge
```{r, warning=FALSE, message=FALSE}
ODS_1 = Reduce(function(x, y) merge(x, y, by= "DEPARTAMENTO", all=TRUE), list(X1_1_1, X1_2_1, X1_3_1, X1_4_1))

ODS_1=ODS_1[rowSums(is.na(ODS_1)) != ncol(ODS_1)-1,]
ODS_1=ODS_1[rowSums(is.na(ODS_1)) != ncol(ODS_1),]
```

# ODS 2

## 2.1.1 Incidencia del déficit calórico
```{r, warning=FALSE, message=FALSE}
url <- "https://github.com/ChiaraZamoraM/ODS/raw/main/2.1.1.xlsx"
destfile <- "X2_1_1.xlsx"
curl::curl_download(url, destfile)
X2_1_1 <- read_excel(destfile, skip = 7)

#colnames(X2_1_1) = str_sub(colnames(X2_1_1), start= -4)

names(X2_1_1) = paste0("ODS2_1_1_",names(X2_1_1))
names(X2_1_1)[1]= "DEPARTAMENTO"
X2_1_1$DEPARTAMENTO= gsub("Resto país","Resto País",X2_1_1$DEPARTAMENTO)
X2_1_1$DEPARTAMENTO= gsub("Nacional","Total",X2_1_1$DEPARTAMENTO)
```

## 2.2.1 Tasa de desnutrición crónica entre las niñas y niños menores de 5 años (OMS)
```{r, warning=FALSE, message=FALSE}
url <- "https://www.inei.gob.pe/media/MenuRecursivo/publicaciones_digitales/Est/Lib1795/cuadros/Cap010.xls"
destfile <- "Cap010.xls"
curl::curl_download(url, destfile)
Cap010 <- read_excel(destfile,sheet = "10.18",skip = 1)

names(Cap010)[c(1,4)]= c("DEPARTAMENTO","2020")
Cap010 =Cap010[,c(1,4)]

Cap010$DEPARTAMENTO =gsub('Total 2020', 'Total', Cap010$DEPARTAMENTO)
Cap010$DEPARTAMENTO =gsub(' [0-9].', '', Cap010$DEPARTAMENTO)

```

```{r, warning=FALSE, message=FALSE}
url <- "https://github.com/ChiaraZamoraM/ODS/raw/main/2.2.1.xlsx"
destfile <- "X2_2_1.xlsx"
curl::curl_download(url, destfile)
X2_2_1 <- read_excel(destfile, skip = 7)
colnames(X2_2_1) = str_sub(colnames(X2_2_1), start= -4)
names(X2_2_1)[1]= "DEPARTAMENTO"


Cap010$DEPARTAMENTO= gsub("Prov. Const. del Callao","Callao",Cap010$DEPARTAMENTO)
#Cap010$DEPARTAMENTO= gsub("Lima Metropolitana","LIMA",Cap010$DEPARTAMENTO)
Cap010$DEPARTAMENTO= gsub("Departamento de Lima","Provincias de Lima",Cap010$DEPARTAMENTO)

X2_2_1$DEPARTAMENTO= gsub("Prov. Const. del Callao","Callao",X2_2_1$DEPARTAMENTO)
#X2_2_1$DEPARTAMENTO= gsub("Provincia de Lima","LIMA",X2_2_1$DEPARTAMENTO)
X2_2_1$DEPARTAMENTO= gsub("Región Lima","Provincias de Lima",X2_2_1$DEPARTAMENTO)
X2_2_1$DEPARTAMENTO= gsub("Nacional","Total",X2_2_1$DEPARTAMENTO)
X2_2_1$DEPARTAMENTO= gsub("Resto Costa","Costa",X2_2_1$DEPARTAMENTO)

X2_2_1 = merge(X2_2_1, Cap010, by = "DEPARTAMENTO", all = TRUE)

names(X2_2_1)[c(2:15)] = paste0("ODS2_2_1_",names(X2_2_1)[c(2:15)])
```

## 2.2.2 Tasa de desnutrición aguda entre las niñas y niños menores de 5 años (OMS)
```{r, warning=FALSE, message=FALSE}
url <- "https://www.inei.gob.pe/media/MenuRecursivo/publicaciones_digitales/Est/Lib1795/cuadros/Cap010.xls"
destfile <- "Cap010.xls"
curl::curl_download(url, destfile)
Cap010_2 <- read_excel(destfile,sheet = "10.18",skip = 6)

names(Cap010_2)[c(1,7)]= c("DEPARTAMENTO","2020")
Cap010_2 =Cap010_2[,c(1,7)]

Cap010_2$DEPARTAMENTO =gsub('Total 2020', 'Total', Cap010_2$DEPARTAMENTO)
Cap010_2$DEPARTAMENTO =gsub(' [0-9].', '', Cap010_2$DEPARTAMENTO)
```

```{r, warning=FALSE, message=FALSE}
url <- "https://github.com/ChiaraZamoraM/ODS/raw/main/2.2.2.xlsx"
destfile <- "X2_2_2.xlsx"
curl::curl_download(url, destfile)
X2_2_2 <- read_excel(destfile, skip = 7)
names(X2_2_2)[1]= "DEPARTAMENTO"
```

```{r, warning=FALSE, message=FALSE}
Cap010_2$DEPARTAMENTO= gsub("Prov. Const. del Callao","Callao",Cap010_2$DEPARTAMENTO)
#Cap010_2$DEPARTAMENTO= gsub("Lima Metropolitana","LIMA",Cap010_2$DEPARTAMENTO)
Cap010_2$DEPARTAMENTO= gsub("Departamento de Lima","Provincias de Lima",Cap010_2$DEPARTAMENTO)

X2_2_2$DEPARTAMENTO= gsub("Prov. Const. del Callao","Callao",X2_2_2$DEPARTAMENTO)
#X2_2_2$DEPARTAMENTO= gsub("Provincia de Lima","LIMA",X2_2_2$DEPARTAMENTO)
X2_2_2$DEPARTAMENTO= gsub("Región Lima","Provincias de Lima",X2_2_2$DEPARTAMENTO)
X2_2_2$DEPARTAMENTO= gsub("Nacional","Total",X2_2_2$DEPARTAMENTO)
X2_2_2$DEPARTAMENTO= gsub("Resto Costa","Costa",X2_2_2$DEPARTAMENTO)
```

```{r, warning=FALSE, message=FALSE}
X2_2_2 = merge(X2_2_2, Cap010_2, by = "DEPARTAMENTO",all = TRUE)

colnames(X2_2_2)[c(2:12)] = paste0("ODS2_2_2_",colnames(X2_2_2)[c(2:12)])

X2_2_2=X2_2_2[rowSums(is.na(X2_2_2)) != ncol(X2_2_2)-1,]
```

## Merge
```{r, warning=FALSE, message=FALSE}
ODS_2 = Reduce(function(x, y) merge(x, y, by= "DEPARTAMENTO", all=TRUE), list(X2_1_1,X2_2_1,X2_2_2))

ODS_2 = ODS_2[rowSums(is.na(ODS_2)) != ncol(ODS_2),]
ODS_2 = ODS_2[rowSums(is.na(ODS_2)) != ncol(ODS_2)-1,]
```

```{r, warning=FALSE, message=FALSE}
ODS_2[,c(2:26)]=lapply(ODS_2[,c(2:26)], as.numeric)
```

# ODS 3

## 3.1.2 Proporción de partos atendidos por personal sanitario especializado
```{r, warning=FALSE, message=FALSE}
url <- "https://github.com/ChiaraZamoraM/ODS/raw/main/3.1.2.xlsx"
destfile <- "X3_1_2.xlsx"
curl::curl_download(url, destfile)
X3_1_2 <- read_excel(destfile, skip = 7)
X3_1_2 = X3_1_2[,-2]
```

```{r, warning=FALSE, message=FALSE}
names(X3_1_2)[1]= "DEPARTAMENTO"
```

```{r, warning=FALSE, message=FALSE}
X3_1_2$DEPARTAMENTO= gsub("Prov. Const. del Callao","Callao",X3_1_2$DEPARTAMENTO)
#X3_1_2$DEPARTAMENTO= gsub("Provincia de Lima","LIMA",X3_1_2$DEPARTAMENTO)
X3_1_2$DEPARTAMENTO= gsub("Región Lima","Provincias de Lima",X3_1_2$DEPARTAMENTO)
X3_1_2$DEPARTAMENTO= gsub("Resto Costa","Costa",X3_1_2$DEPARTAMENTO)
X3_1_2$DEPARTAMENTO= gsub("Nacional","Total",X3_1_2$DEPARTAMENTO)
```

```{r, warning=FALSE, message=FALSE}
url <- "https://www.inei.gob.pe/media/MenuRecursivo/publicaciones_digitales/Est/Lib1795/cuadros/Cap008.xlsx"
destfile <- "Cap008.xlsx"
curl::curl_download(url, destfile)
Cap008 <- read_excel(destfile,sheet = "8.11",skip = 6)

names(Cap008)[c(1,9)]= c("DEPARTAMENTO","2020")
Cap008 =Cap008[,c(1,9)]

Cap008$DEPARTAMENTO =gsub(' [0-9].', '', Cap008$DEPARTAMENTO)

Cap008$DEPARTAMENTO= gsub("Prov. Const. del Callao","Callao",Cap008$DEPARTAMENTO)
#Cap008$DEPARTAMENTO= gsub("Lima Metropolitana","LIMA",Cap008$DEPARTAMENTO)
Cap008$DEPARTAMENTO= gsub("Departamento de Lima","Provincias de Lima",Cap008$DEPARTAMENTO)
Cap008$DEPARTAMENTO =gsub('Total20', 'Total', Cap008$DEPARTAMENTO)

X3_1_2 = merge(X3_1_2, Cap008, by = "DEPARTAMENTO",all = TRUE)

colnames(X3_1_2)[c(2:ncol(X3_1_2))] = paste0("ODS3_1_2_",colnames(X3_1_2)[c(2:ncol(X3_1_2))])
```

```{r, warning=FALSE, message=FALSE}
X3_1_2 = X3_1_2[rowSums(is.na(X3_1_2)) != ncol(X3_1_2),]
X3_1_2 = X3_1_2[rowSums(is.na(X3_1_2)) != ncol(X3_1_2)-1,]

#Ojo con Provincia de Lima y Lima Metropolitana
```


## 3.2.1 Tasa de mortalidad de niños menores de 5 años de edad
```{r, warning=FALSE, message=FALSE}
X3_2_1_D <- import("https://www.inei.gob.pe/media/MenuRecursivo/publicaciones_digitales/Est/Lib1829/cap06/cap06071.xlsx")
names(X3_2_1_D) <- X3_2_1_D[7,]
X3_2_1_D = X3_2_1_D[-c(1:10),-c(2:8)]
names(X3_2_1_D)= sub('.*(\\d{4}).*', '\\1', names(X3_2_1_D))
names(X3_2_1_D)[1]= "DEPARTAMENTO"
X3_2_1_D$DEPARTAMENTO =gsub(' [0-9].', '', X3_2_1_D$DEPARTAMENTO)

X3_2_1_A <- import("https://www.inei.gob.pe/media/MenuRecursivo/publicaciones_digitales/Est/Lib1829/cap06/cap06070.xlsx")
names(X3_2_1_A) <- X3_2_1_A[6,]
X3_2_1_A = X3_2_1_A[-c(1:27),]
names(X3_2_1_A)= sub('.*(\\d{4}).*', '\\1', names(X3_2_1_A))
names(X3_2_1_A)[1]= "DEPARTAMENTO"

#Alternativa: \\D*(\\d{4}).*

X3_2_1_R=merge(X3_2_1_D,X3_2_1_A,all = TRUE)

X3_2_1_R$DEPARTAMENTO= gsub("Prov. Const. del Callao","Callao",X3_2_1_R$DEPARTAMENTO)
#X3_2_1_R$DEPARTAMENTO= gsub("Lima Metropolitana","LIMA",Cap008$DEPARTAMENTO)
X3_2_1_R$DEPARTAMENTO= gsub("^Lima$","Provincias de Lima",X3_2_1_R$DEPARTAMENTO)
X3_2_1_R$DEPARTAMENTO= gsub("Departamento de Lima","Lima",X3_2_1_R$DEPARTAMENTO)

colnames(X3_2_1_R)[c(2:ncol(X3_2_1_R))] = paste0("ODS3_2_1_",colnames(X3_2_1_R)[c(2:ncol(X3_2_1_R))])

X3_2_1_R = X3_2_1_R[rowSums(is.na(X3_2_1_R)) != ncol(X3_2_1_R),]
X3_2_1 = X3_2_1_R[rowSums(is.na(X3_2_1_R)) != ncol(X3_2_1_R)-1,]
```

## 3.2.2 Tasa de mortalidad neonatal
```{r, warning=FALSE, message=FALSE}
url <- "https://github.com/ChiaraZamoraM/ODS/raw/main/3.2.2.xlsx"
destfile <- "X3_2_2.xlsx"
curl::curl_download(url, destfile)
X3_2_2 <- read_excel(destfile, skip = 7)

colnames(X3_2_2) = str_sub(colnames(X3_2_2), start= -4)

names(X3_2_2) = paste0("ODS3_2_2_",names(X3_2_2))
names(X3_2_2)[1]= "DEPARTAMENTO"
#X3_2_2$DEPARTAMENTO= gsub("Resto país","Resto País",X3_2_2$DEPARTAMENTO)
X3_2_2$DEPARTAMENTO= gsub("Nacional","Total",X3_2_2$DEPARTAMENTO)
```

## 3.3.1 Tasa de notificación de casos del Virus de la Inmunodeficiencia Humana (VIH) por cada 100 000 habitantes
```{r, warning=FALSE, message=FALSE}
X3_3_1 <- import("https://www.inei.gob.pe/media/MenuRecursivo/publicaciones_digitales/Est/Lib1829/cap06/cap06027.xlsx")
names(X3_3_1) <- X3_3_1[3,]
colnames(X3_3_1)[6]="2017"
X3_3_1 = X3_3_1[-c(1:5,22),]
colnames(X3_3_1) = paste0("ODS3_3_1_",colnames(X3_3_1))
names(X3_3_1)[1]= "DEPARTAMENTO"

X3_3_1$DEPARTAMENTO =gsub(' [0-9].', '', X3_3_1$DEPARTAMENTO)
```

```{r, warning=FALSE, message=FALSE}
X3_3_1$DEPARTAMENTO= gsub("Prov. Const. del Callao","Callao",X3_3_1$DEPARTAMENTO)
#X3_2_1_R$DEPARTAMENTO= gsub("Lima Metropolitana","LIMA",Cap008$DEPARTAMENTO)
X3_3_1$DEPARTAMENTO= gsub("^Lima$","Provincias de Lima",X3_3_1$DEPARTAMENTO)
```

## 3.3.2 Incidencia de la tuberculosis por cada 100 000 habitantes
```{r, warning=FALSE, message=FALSE}
url <- "https://github.com/ChiaraZamoraM/ODS/raw/main/3.3.2.xlsx"
destfile <- "X3_3_2.xlsx"
curl::curl_download(url, destfile)
X3_3_2 <- read_excel(destfile, skip = 7)

colnames(X3_3_2) = paste0("ODS3_3_2_",colnames(X3_3_2))
```

```{r, warning=FALSE, message=FALSE}
X3_3_2[,c(2:23)]=lapply(X3_3_2[,c(2:23)], as.numeric)

names(X3_3_2)[1]= "DEPARTAMENTO"
```

```{r, warning=FALSE, message=FALSE}
X3_3_2$DEPARTAMENTO= gsub("Prov. Const. del Callao","Callao",X3_3_2$DEPARTAMENTO)
X3_3_2$DEPARTAMENTO= gsub("Provincia de Lima","Lima Metropolitana",X3_3_2$DEPARTAMENTO)
X3_3_2$DEPARTAMENTO= gsub("Región Lima","Provincias de Lima",X3_3_2$DEPARTAMENTO)
X3_3_2$DEPARTAMENTO= gsub("Nacional","Total",X3_3_2$DEPARTAMENTO)
```

## 3.3.3 Incidencia de la malaria por cada 100 000 habitantes
```{r, warning=FALSE, message=FALSE}
url <- "https://github.com/ChiaraZamoraM/ODS/raw/main/3.3.3.xlsx"
destfile <- "X3_3_3.xlsx"
curl::curl_download(url, destfile)
X3_3_3 <- read_excel(destfile, skip = 7)

colnames(X3_3_3) = paste0("ODS3_3_3_",colnames(X3_3_3))
```

```{r, warning=FALSE, message=FALSE}
X3_3_3[,c(2:39)]=lapply(X3_3_3[,c(2:39)], as.numeric)

names(X3_3_3)[1]= "DEPARTAMENTO"
```

```{r, warning=FALSE, message=FALSE}
X3_3_3$DEPARTAMENTO= gsub("Prov. Const. del Callao","Callao",X3_3_3$DEPARTAMENTO)
X3_3_3$DEPARTAMENTO= gsub("Nacional","Total",X3_3_3$DEPARTAMENTO)
#X3_3_3$DEPARTAMENTO= gsub("Lima","Provincia de Lima",X3_3_3$DEPARTAMENTO)
#X3_3_3= rbind(X3_3_3, X3_3_3[rep(18),])

#X3_3_3[33,1]= "Provincias de Lima"
```

## 3.3.4 Incidencia de la hepatitis B por cada 100 000 habitantes
```{r, warning=FALSE, message=FALSE}
url <- "https://github.com/ChiaraZamoraM/ODS/raw/main/3.3.4.xlsx"
destfile <- "X3_3_4.xlsx"
curl::curl_download(url, destfile)
X3_3_4 <- read_excel(destfile, skip = 7)

colnames(X3_3_4) = paste0("ODS3_3_4_",colnames(X3_3_4))
```

```{r, warning=FALSE, message=FALSE}
X3_3_4[,c(2:19)]=lapply(X3_3_4[,c(2:19)], as.numeric)

names(X3_3_4)[1]= "DEPARTAMENTO"
```

```{r, warning=FALSE, message=FALSE}
X3_3_4$DEPARTAMENTO= gsub("Prov. Const. del Callao","Callao",X3_3_4$DEPARTAMENTO)
X3_3_4$DEPARTAMENTO= gsub("Provincia de Lima","Lima Metropolitana",X3_3_4$DEPARTAMENTO)
X3_3_4$DEPARTAMENTO= gsub("Región Lima","Provincias de Lima",X3_3_4$DEPARTAMENTO)
X3_3_4$DEPARTAMENTO= gsub("Nacional","Total",X3_3_4$DEPARTAMENTO)
```

## 3.5.2 Proporción de personas de 15 y más años de edad que consumieron alguna bebida alcohólica en los últimos 12 meses
```{r, warning=FALSE, message=FALSE}
url <- "https://github.com/ChiaraZamoraM/ODS/raw/main/3.5.2.xlsx"
destfile <- "X3_5_2.xlsx"
curl::curl_download(url, destfile)
X3_5_2 <- read_excel(destfile, skip = 7)

colnames(X3_5_2) = paste0("ODS3_5_2_",colnames(X3_5_2))

```

```{r, warning=FALSE, message=FALSE}
X3_5_2[,c(2:7)]=lapply(X3_5_2[,c(2:7)], as.numeric)

names(X3_5_2)[1]= "DEPARTAMENTO"
```

```{r, warning=FALSE, message=FALSE}
X3_5_2$DEPARTAMENTO= gsub("Prov. Const. del Callao","Callao",X3_5_2$DEPARTAMENTO)
#X3_5_2$DEPARTAMENTO= gsub("Provincia de Lima","Lima Metropolitana",X3_5_2$DEPARTAMENTO)
X3_5_2$DEPARTAMENTO= gsub("Región Lima","Provincias de Lima",X3_5_2$DEPARTAMENTO)
X3_5_2$DEPARTAMENTO= gsub("Nacional","Total",X3_5_2$DEPARTAMENTO)
```

## 3.6.1 Tasa de fallecidos por accidentes de tránsito
```{r, warning=FALSE, message=FALSE}
url <- "https://github.com/ChiaraZamoraM/ODS/raw/main/3.6.1.xlsx"
destfile <- "X3_6_1.xlsx"
curl::curl_download(url, destfile)
X3_6_1 <- read_excel(destfile, skip = 7)

colnames(X3_6_1) = paste0("ODS3_6_1_",colnames(X3_6_1))
```

```{r, warning=FALSE, message=FALSE}
X3_6_1[,c(2:8)]=lapply(X3_6_1[,c(2:8)], as.numeric)

names(X3_6_1)[1]= "DEPARTAMENTO"
```

```{r, warning=FALSE, message=FALSE}
X3_6_1$DEPARTAMENTO= gsub("Prov. Const. del Callao","Callao",X3_6_1$DEPARTAMENTO)
X3_6_1$DEPARTAMENTO= gsub("Provincia de Lima","Lima Metropolitana",X3_6_1$DEPARTAMENTO)
X3_6_1$DEPARTAMENTO= gsub("Región Lima","Provincias de Lima",X3_6_1$DEPARTAMENTO)
X3_6_1$DEPARTAMENTO= gsub("Nacional","Total",X3_6_1$DEPARTAMENTO)
```

## 3.7.1 Proporción de mujeres en edad fértil (de 15 a 49 años) que practican la planificación familiar con métodos modernos
```{r, warning=FALSE, message=FALSE}
X3_7_1 <- import("https://www.inei.gob.pe/media/MenuRecursivo/publicaciones_digitales/Est/Lib1829/cap06/cap06076.xlsx")
names(X3_7_1) <- X3_7_1[4,]
X3_7_1 = X3_7_1[-c(1:5),]
colnames(X3_7_1) = str_sub(colnames(X3_7_1), start= -4)

colnames(X3_7_1) = paste0("ODS3_7_1_",colnames(X3_7_1))
names(X3_7_1)[1]= "DEPARTAMENTO"

X3_7_1$DEPARTAMENTO =gsub(' [0-9].', '', X3_7_1$DEPARTAMENTO)
```

```{r, warning=FALSE, message=FALSE}
X3_7_1$DEPARTAMENTO= gsub("Prov. Const. del Callao","Callao",X3_7_1$DEPARTAMENTO)
#X3_2_1_R$DEPARTAMENTO= gsub("Lima Metropolitana","LIMA",Cap008$DEPARTAMENTO)
X3_7_1$DEPARTAMENTO= gsub("^Lima$","Provincias de Lima",X3_7_1$DEPARTAMENTO)
X3_7_1$DEPARTAMENTO= gsub("Departamento de Lima","Lima",X3_7_1$DEPARTAMENTO)
X3_7_1$DEPARTAMENTO= gsub("La  Libertad","La Libertad",X3_7_1$DEPARTAMENTO)
X3_7_1$DEPARTAMENTO= gsub("Resto de Costa","Resto Costa",X3_7_1$DEPARTAMENTO)
X3_7_1= X3_7_1[-8,]

#Lima es Lima Metropolitana + Departamento de Lima
```

## 3.7.2 Tasa de fecundidad adolescente de 15 a 19 años de edad
```{r, warning=FALSE, message=FALSE}
url <- "https://www.inei.gob.pe/media/MenuRecursivo/publicaciones_digitales/Est/Lib1795/cuadros/Cap013.xlsx"
destfile <- "X3_7_2.xlsx"
curl::curl_download(url, destfile)
X3_7_2 <- read_excel(destfile,sheet = "13.4",skip = 4)

colnames(X3_7_2) = str_sub(colnames(X3_7_2), start= -4)
colnames(X3_7_2) = paste0("ODS3_7_2_",colnames(X3_7_2))
colnames(X3_7_2)[1]="DEPARTAMENTO"
```

## 3.8.1 Proporción de la población con seguro de salud

```{r, warning=FALSE, message=FALSE}
X3_8_1 <- import("https://www.inei.gob.pe/media/MenuRecursivo/publicaciones_digitales/Est/Lib1829/cap06/cap06090.xlsx")
names(X3_8_1) <- X3_8_1[5,]
X3_8_1 = X3_8_1[-c(1:6,40:44),]
colnames(X3_8_1) = paste0("ODS3_8_1_",colnames(X3_8_1))
names(X3_8_1)[1]= "DEPARTAMENTO"

X3_8_1$DEPARTAMENTO= gsub("Prov. Const. del Callao","Callao",X3_8_1$DEPARTAMENTO)
X3_8_1$DEPARTAMENTO= gsub("Lima 2/","Provincias de Lima",X3_8_1$DEPARTAMENTO)

X3_8_1$DEPARTAMENTO =gsub(' [0-9].', '', X3_8_1$DEPARTAMENTO)
```

## 3.a.1 Proporción de personas de 15 y más años de edad que actualmente fuman cigarros
```{r, warning=FALSE, message=FALSE}
url <- "https://github.com/ChiaraZamoraM/ODS/raw/main/3.a.1.xlsx"
destfile <- "X3_a_1.xlsx"
curl::curl_download(url, destfile)
X3_a_1 <- read_excel(destfile, skip = 7)

colnames(X3_a_1) = str_sub(colnames(X3_a_1), start= -4)

names(X3_a_1) = paste0("ODS3_a_1_",names(X3_a_1))
names(X3_a_1)[1]= "DEPARTAMENTO"
```

```{r, warning=FALSE, message=FALSE}
X3_a_1$DEPARTAMENTO= gsub("Prov. Const. del Callao","Callao",X3_a_1$DEPARTAMENTO)
#X1_3_1$DEPARTAMENTO= gsub("Provincia de Lima","Lima Metropolitana",X1_3_1$DEPARTAMENTO)
X3_a_1$DEPARTAMENTO= gsub("Región Lima","Provincias de Lima",X3_a_1$DEPARTAMENTO)
X3_a_1$DEPARTAMENTO= gsub("Nacional","Total",X3_a_1$DEPARTAMENTO)
X3_a_1$DEPARTAMENTO= gsub("Resto país","Resto País",X3_a_1$DEPARTAMENTO)
X3_a_1$DEPARTAMENTO= gsub("Resto Urbano","Urbana",X3_a_1$DEPARTAMENTO)
```

```{r, warning=FALSE, message=FALSE}
url <- "https://www.inei.gob.pe/media/MenuRecursivo/publicaciones_digitales/Est/Lib1795/cuadros/Cap013.xlsx"
destfile <- "X3_a_1_R.xlsx"
curl::curl_download(url, destfile)
X3_a_1_R <- read_excel(destfile,sheet = "13.9",skip = 4)
X3_a_1_R = X3_a_1_R[-c(10:14,16:nrow(X3_a_1_R)),c(1,9)]
names(X3_a_1_R) = paste0("ODS3_a_1_",names(X3_a_1_R))
colnames(X3_a_1_R)[1] = "DEPARTAMENTO"

X3_a_1 =  merge(X3_a_1, X3_a_1_R, by="DEPARTAMENTO", all = TRUE)
```

## 3.c.1.a Número de médicos colegiados por cada 10 000 habitantes
```{r, warning=FALSE, message=FALSE}
X3_c_1 <- import("https://www.inei.gob.pe/media/MenuRecursivo/publicaciones_digitales/Est/Lib1829/cap06/cap06005.xlsx")
names(X3_c_1) <- as.character(X3_c_1[4,])
X3_c_1 = X3_c_1[-c(1:5,33:35),]
colnames(X3_c_1) = paste0("ODS3_c_1_",colnames(X3_c_1))
names(X3_c_1)[1]= "DEPARTAMENTO"

X3_c_1$DEPARTAMENTO= gsub("Prov. Const. del Callao","Callao",X3_c_1$DEPARTAMENTO)
```


```{r, warning=FALSE, message=FALSE}
ODS_3 = Reduce(function(x, y) merge(x, y, by= "DEPARTAMENTO",all=TRUE), list(X3_1_2, X3_2_1,
                                                                    X3_2_2,X3_3_1,
                                                                    X3_3_2,X3_3_3,
                                                                    X3_3_4,X3_5_2,
                                                                    X3_6_1,X3_7_1,
                                                                    X3_7_2,
                                                                    X3_8_1,X3_a_1,
                                                                    X3_c_1))
ODS_3=ODS_3[rowSums(is.na(ODS_3)) != ncol(ODS_3),]
ODS_3=ODS_3[rowSums(is.na(ODS_3)) != ncol(ODS_3)-1,]
```


# ODS 4

## 4.1.1.4 --> 4.1.1 Proporción de estudiantes de segundo grado de secundaria con nivel satisfactorio en Comprensión de Lectura
```{r, warning=FALSE, message=FALSE}
X4_1_1 <- import("https://www.inei.gob.pe/media/MenuRecursivo/publicaciones_digitales/Est/Lib1829/cap05/cap05052.xlsx")
names(X4_1_1) <- as.character(X4_1_1[5,])
X4_1_1 = X4_1_1[-c(1:6,44:48),c(1,8:11)]
colnames(X4_1_1) = paste0("ODS4_1_1_",colnames(X4_1_1))
names(X4_1_1)[1]= "DEPARTAMENTO"

X4_1_1$DEPARTAMENTO =gsub(' [0-9].', '', X4_1_1$DEPARTAMENTO)
```

```{r, warning=FALSE, message=FALSE}
X4_1_1$DEPARTAMENTO= gsub("Prov. Const. del Callao","Callao",X4_1_1$DEPARTAMENTO)
#X4_1_1$DEPARTAMENTO= gsub("Lima Metropolitana","LIMA",X4_1_1$DEPARTAMENTO)
X4_1_1$DEPARTAMENTO= gsub("Departamento de Lima","Provincias de Lima",X4_1_1$DEPARTAMENTO)
```

## 4.1.1.6--> 4.1.2 Proporción de estudiantes de segundo grado de secundaria con nivel satisfactorio en Razonamiento Matemático
```{r, warning=FALSE, message=FALSE}
X4_1_2 <- import("https://www.inei.gob.pe/media/MenuRecursivo/publicaciones_digitales/Est/Lib1829/cap05/cap05052.xlsx")
names(X4_1_2) <- as.character(X4_1_2[5,])
X4_1_2 = X4_1_2[-c(1:6,44:48),c(1:5)]
colnames(X4_1_2) = paste0("ODS4_1_2_",colnames(X4_1_2))
names(X4_1_2)[1]= "DEPARTAMENTO"

X4_1_2$DEPARTAMENTO =gsub(' [0-9].', '', X4_1_2$DEPARTAMENTO)
```

```{r, warning=FALSE, message=FALSE}
X4_1_2$DEPARTAMENTO= gsub("Prov. Const. del Callao","Callao",X4_1_2$DEPARTAMENTO)
#X4_1_2$DEPARTAMENTO= gsub("Lima Metropolitana","LIMA",X4_1_2$DEPARTAMENTO)
X4_1_2$DEPARTAMENTO= gsub("Departamento de Lima","Provincias de Lima",X4_1_2$DEPARTAMENTO)
```

## 4.1.1.8 --> 4.1.3 Proporción de estudiantes de cuarto grado de primaria con nivel satisfactorio en Comprensión de Lectura

```{r, warning=FALSE, message=FALSE}
X4_1_3 <- import("https://www.inei.gob.pe/media/MenuRecursivo/publicaciones_digitales/Est/Lib1829/cap05/cap05051.xlsx")
names(X4_1_3) <- as.character(X4_1_3[7,])
X4_1_3 = X4_1_3[-c(1:8,46:51),c(1,7:10)]
colnames(X4_1_3) = paste0("ODS4_1_3_",colnames(X4_1_3))
names(X4_1_3)[1]= "DEPARTAMENTO"

X4_1_3$DEPARTAMENTO =gsub(' [0-9].', '', X4_1_3$DEPARTAMENTO)
```

```{r, warning=FALSE, message=FALSE}
X4_1_3$DEPARTAMENTO= gsub("Prov. Const. del Callao","Callao",X4_1_3$DEPARTAMENTO)
#X4_1_3$DEPARTAMENTO= gsub("Lima Metropolitana","LIMA",X4_1_3$DEPARTAMENTO)
X4_1_3$DEPARTAMENTO= gsub("Departamento de Lima","Provincias de Lima",X4_1_3$DEPARTAMENTO)
```

## 4.1.1.10 --> 4.1.4 Proporción de estudiantes de cuarto grado de primaria con nivel satisfactorio en Razonamiento Matemático
```{r, warning=FALSE, message=FALSE}
X4_1_4 <- import("https://www.inei.gob.pe/media/MenuRecursivo/publicaciones_digitales/Est/Lib1829/cap05/cap05051.xlsx")
names(X4_1_4) <- as.character(X4_1_4[7,])
X4_1_4 = X4_1_4[-c(1:8,46:51),c(1:5)]
colnames(X4_1_4) = paste0("ODS4_1_4_",colnames(X4_1_4))
names(X4_1_4)[1]= "DEPARTAMENTO"

X4_1_4$DEPARTAMENTO =gsub(' [0-9].', '', X4_1_4$DEPARTAMENTO)
```

```{r, warning=FALSE, message=FALSE}
X4_1_4$DEPARTAMENTO= gsub("Prov. Const. del Callao","Callao",X4_1_4$DEPARTAMENTO)
#X4_1_4$DEPARTAMENTO= gsub("Lima Metropolitana","LIMA",X4_1_4$DEPARTAMENTO)
X4_1_4$DEPARTAMENTO= gsub("Departamento de Lima","Provincias de Lima",X4_1_4$DEPARTAMENTO)
```

## 4.2.2 Tasa de participación en el aprendizaje organizado (un año antes de la edad oficial del ingreso primario)
```{r, warning=FALSE, message=FALSE}
X4_2_2 <- import("https://www.inei.gob.pe/media/MenuRecursivo/publicaciones_digitales/Est/Lib1829/cap05/cap05057.xlsx")
names(X4_2_2) <- as.character(X4_2_2[6,])
X4_2_2 = X4_2_2[-c(1:7,45:48),]
colnames(X4_2_2) = paste0("ODS4_2_2_",colnames(X4_2_2))
names(X4_2_2)[1]= "DEPARTAMENTO"

X4_2_2$DEPARTAMENTO =gsub(' [0-9].', '', X4_2_2$DEPARTAMENTO)
```

```{r, warning=FALSE, message=FALSE}
X4_2_2$DEPARTAMENTO= gsub("Prov. Const. del Callao","Callao",X4_2_2$DEPARTAMENTO)
#X4_2_2$DEPARTAMENTO= gsub("Lima Metropolitana","LIMA",X4_6_1$DEPARTAMENTO)
X4_2_2$DEPARTAMENTO= gsub("Departamento de Lima","Provincias de Lima",X4_2_2$DEPARTAMENTO)
```

## 4.3.1 Tasa de asistencia a educación superior de la población de 17 a 24 años de edad
```{r, warning=FALSE, message=FALSE}
url <- "https://github.com/ChiaraZamoraM/ODS/raw/main/4.3.1.xlsx"
destfile <- "X4_3_1.xlsx"
curl::curl_download(url, destfile)
X4_3_1 <- read_excel(destfile, skip = 7)

colnames(X4_3_1) = paste0("ODS4_3_1_",colnames(X4_3_1))

names(X4_3_1)[1]= "DEPARTAMENTO"
```

```{r, warning=FALSE, message=FALSE}
X4_3_1$DEPARTAMENTO= gsub("Prov. Const. del Callao","Callao",X4_3_1$DEPARTAMENTO)
#X4_3_1$DEPARTAMENTO= gsub("Provincia de Lima","Lima Metropolitana",X4_3_1$DEPARTAMENTO)
X4_3_1$DEPARTAMENTO= gsub("Región Lima","Provincias de Lima",X4_3_1$DEPARTAMENTO)
X4_3_1$DEPARTAMENTO= gsub("Nacional","Total",X4_3_1$DEPARTAMENTO)
X4_3_1$DEPARTAMENTO= gsub("Resto país","Resto País",X4_3_1$DEPARTAMENTO)
```

## 4.5.1 Índice de paridad en la matrícula a educación inicial de la población 3 a 5 años de edad
```{r, warning=FALSE, message=FALSE}
url <- "https://github.com/ChiaraZamoraM/ODS/raw/main/4.5.1.xlsx"
destfile <- "X4_5_1.xlsx"
curl::curl_download(url, destfile)
X4_5_1 <- read_excel(destfile, skip = 7)

colnames(X4_5_1) = str_sub(colnames(X4_5_1), start= -4)

names(X4_5_1) = paste0("ODS4_5_1_",names(X4_5_1))
names(X4_5_1)[1]= "DEPARTAMENTO"
```

```{r, warning=FALSE, message=FALSE}
X4_5_1$DEPARTAMENTO= gsub("Nacional","Total",X4_5_1$DEPARTAMENTO)
```

## 4.6.1 Tasa de alfabetización de la población de 15 y más años de edad (Con cartilla de lectura)
```{r, warning=FALSE, message=FALSE}
X4_6_1 <- import("https://www.inei.gob.pe/media/MenuRecursivo/publicaciones_digitales/Est/Lib1829/cap05/cap05057.xlsx")
names(X4_6_1) <- as.character(X4_6_1[6,])
X4_6_1 = X4_6_1[-c(1:7,45:48),]
colnames(X4_6_1) = paste0("ODS4_6_1_",colnames(X4_6_1))
names(X4_6_1)[1]= "DEPARTAMENTO"

X4_6_1$DEPARTAMENTO =gsub(' [0-9].', '', X4_6_1$DEPARTAMENTO)
```

```{r, warning=FALSE, message=FALSE}
X4_6_1$DEPARTAMENTO= gsub("Prov. Const. del Callao","Callao",X4_6_1$DEPARTAMENTO)
#X4_6_1$DEPARTAMENTO= gsub("Lima Metropolitana","LIMA",X4_6_1$DEPARTAMENTO)
X4_6_1$DEPARTAMENTO= gsub("Departamento de Lima","Provincias de Lima",X4_6_1$DEPARTAMENTO)
```

## 4.a.1 Proporción de escuelas con acceso a electricidad
```{r, warning=FALSE, message=FALSE}
url <- "https://github.com/ChiaraZamoraM/ODS/raw/main/4.a.1.xlsx"
destfile <- "X4_a_1.xlsx"
curl::curl_download(url, destfile)
X4_a_1 <- read_excel(destfile, skip = 7)

colnames(X4_a_1) = paste0("ODS4_a_1_",colnames(X4_a_1))

names(X4_a_1)[1]= "DEPARTAMENTO"
```

```{r, warning=FALSE, message=FALSE}
X4_a_1$DEPARTAMENTO= gsub("Prov. Const. del Callao","Callao",X4_a_1$DEPARTAMENTO)
X4_a_1$DEPARTAMENTO= gsub("Provincia de Lima","Lima Metropolitana",X4_a_1$DEPARTAMENTO)
X4_a_1$DEPARTAMENTO= gsub("Región Lima","Provincias de Lima",X4_a_1$DEPARTAMENTO)
X4_a_1$DEPARTAMENTO= gsub("Nacional","Total",X4_a_1$DEPARTAMENTO)
```

## 4.a.1.e --> 4.a.2 Proporción de escuelas con acceso a abastecimiento de agua mediante red pública dentro del local escolar
```{r, warning=FALSE, message=FALSE}
url <- "https://github.com/ChiaraZamoraM/ODS/raw/main/4.a.1.e.xlsx"
destfile <- "4.a.1.e.xlsx"
curl::curl_download(url, destfile)
X4_a_2 <- read_excel(destfile, skip = 7)

colnames(X4_a_2) = paste0("ODS4_a_2_",colnames(X4_a_2))

names(X4_a_2)[1]= "DEPARTAMENTO"
```

```{r, warning=FALSE, message=FALSE}
X4_a_2$DEPARTAMENTO= gsub("Prov. Const. del Callao","Callao",X4_a_2$DEPARTAMENTO)
X4_a_2$DEPARTAMENTO= gsub("Provincia de Lima","Lima Metropolitana",X4_a_2$DEPARTAMENTO)
X4_a_2$DEPARTAMENTO= gsub("Región Lima","Provincias de Lima",X4_a_2$DEPARTAMENTO)
X4_a_2$DEPARTAMENTO= gsub("Nacional","Total",X4_a_2$DEPARTAMENTO)
```

## 4.a.1.f --> 4.a.3 Proporción de escuelas con acceso a inodoro conectado a red pública
```{r, warning=FALSE, message=FALSE}
url <- "https://github.com/ChiaraZamoraM/ODS/raw/main/4.a.1.f.xlsx"
destfile <- "4.a.1.f.xlsx"
curl::curl_download(url, destfile)
X4_a_3 <- read_excel(destfile, skip = 7)

colnames(X4_a_3) = paste0("ODS4_a_3_",colnames(X4_a_3))

names(X4_a_3)[1]= "DEPARTAMENTO"
```

```{r, warning=FALSE, message=FALSE}
X4_a_3$DEPARTAMENTO= gsub("Prov. Const. del Callao","Callao",X4_a_3$DEPARTAMENTO)
X4_a_3$DEPARTAMENTO= gsub("Provincia de Lima","Lima Metropolitana",X4_a_3$DEPARTAMENTO)
X4_a_3$DEPARTAMENTO= gsub("Región Lima","Provincias de Lima",X4_a_3$DEPARTAMENTO)
X4_a_3$DEPARTAMENTO= gsub("Nacional","Total",X4_a_3$DEPARTAMENTO)
```

## 4.c.1 Proporción de docentes de educación inicial que recibieron la mínima formación pedagógica durante el empleo
```{r, warning=FALSE, message=FALSE}
url <- "https://github.com/ChiaraZamoraM/ODS/raw/main/4.c.1.xlsx"
destfile <- "X4_c_1.xlsx"
curl::curl_download(url, destfile)
X4_c_1 <- read_excel(destfile, skip = 7)

colnames(X4_c_1) = paste0("ODS4_c_1_",colnames(X4_c_1))

names(X4_c_1)[1]= "DEPARTAMENTO"
```

```{r, warning=FALSE, message=FALSE}
X4_c_1$DEPARTAMENTO= gsub("Prov. Const. del Callao","Callao",X4_c_1$DEPARTAMENTO)
X4_c_1$DEPARTAMENTO= gsub("Provincia de Lima","Lima Metropolitana",X4_c_1$DEPARTAMENTO)
X4_c_1$DEPARTAMENTO= gsub("Región Lima","Provincias de Lima",X4_c_1$DEPARTAMENTO)
X4_c_1$DEPARTAMENTO= gsub("Nacional","Total",X4_c_1$DEPARTAMENTO)
```

## Merge

```{r, warning=FALSE, message=FALSE}
ODS_4 = Reduce(function(x, y) merge(x, y, by= "DEPARTAMENTO",all=TRUE), list(X4_1_1, X4_1_2,
                                                                             X4_1_3, X4_1_4,
                                                                             X4_2_2, X4_3_1,
                                                                             X4_5_1,
                                                                             X4_6_1, X4_a_1,
                                                                             X4_a_2, X4_a_3,
                                                                             X4_c_1
                                                                             ))
ODS_4=ODS_4[rowSums(is.na(ODS_4)) != ncol(ODS_4),]
ODS_4=ODS_4[rowSums(is.na(ODS_4)) != ncol(ODS_4)-1,]
```

# ODS 5

## 5.2.1 Proporción de mujeres de 15 a 49 años de edad que han sufrido violencia física y/o sexual ejercida por el esposo o compañero en los últimos 12 meses
```{r, warning=FALSE, message=FALSE}
url <- "https://github.com/ChiaraZamoraM/ODS/raw/main/5.2.1.xlsx"
destfile <- "X5_2_1.xlsx"
curl::curl_download(url, destfile)
X5_2_1 <- read_excel(destfile, skip = 7)


colnames(X5_2_1) = paste0("ODS5_2_1_",colnames(X5_2_1))
names(X5_2_1)[1]= "DEPARTAMENTO"
```

```{r, warning=FALSE, message=FALSE}
X5_2_1$DEPARTAMENTO= gsub("Prov. Const. del Callao","Callao",X5_2_1$DEPARTAMENTO)
X5_2_1$DEPARTAMENTO= gsub("Provincia de Lima","Lima Metropolitana",X5_2_1$DEPARTAMENTO)
X5_2_1$DEPARTAMENTO= gsub("Región Lima","Provincias de Lima",X5_2_1$DEPARTAMENTO)
X5_2_1$DEPARTAMENTO= gsub("Nacional","Total",X5_2_1$DEPARTAMENTO)
```

```{r, warning=FALSE, message=FALSE}
X5_2_1_R <- import("https://www.inei.gob.pe/media/MenuRecursivo/publicaciones_digitales/Est/Lib1829/cap08/cap08029.xlsx")
names(X5_2_1_R) <- as.character(X5_2_1_R[5,])
X5_2_1_R = X5_2_1_R[-c(1:6,17:31),c(1,11)]
colnames(X5_2_1_R) = paste0("ODS5_2_1_",colnames(X5_2_1_R))
names(X5_2_1_R)[1]= "DEPARTAMENTO"

X5_2_1_R$DEPARTAMENTO =gsub(' [0-9].', '', X5_2_1_R$DEPARTAMENTO)
```

```{r, warning=FALSE, message=FALSE}
X5_2_1 = merge(X5_2_1_R, X5_2_1, by = "DEPARTAMENTO",all = TRUE)

X5_2_1=X5_2_1[rowSums(is.na(X5_2_1)) != ncol(X5_2_1)-1,]
```

## 5.2.2 Proporción de mujeres de 18 y más años de edad que fueron alguna vez víctimas de violencia sexual, por parte de otra persona que no es su actual esposo o compañero

## 5.3.1 Proporción de mujeres de entre 20 y 24 años que estaban casadas o mantenían una unión estable antes de cumplir los 15 años y antes de cumplir los 18 años

## 5.5.1 Proporción de escaños ocupados por mujeres en los parlamentos nacionales por período congresal
```{r, warning=FALSE, message=FALSE}
#url <- "https://github.com/ChiaraZamoraM/ODS/raw/main/5.5.1.xlsx"
#destfile <- "X5_5_1.xlsx"
#curl::curl_download(url, destfile)
#X5_5_1 <- read_excel(destfile, skip = 7)

#colnames(X5_5_1) = str_sub(colnames(X5_5_1), start= 1, end=4)

#colnames(X5_5_1) = paste0("ODS5_5_1_",colnames(X5_5_1))
#names(X5_5_1)[1]= "DEPARTAMENTO"
```

```{r, warning=FALSE, message=FALSE}
#X5_5_1$DEPARTAMENTO= gsub("Prov. Const. del Callao","Callao",X5_5_1$DEPARTAMENTO)
#X5_5_1$DEPARTAMENTO= gsub("Provincia de Lima","Lima Metropolitana",X5_5_1$DEPARTAMENTO)
#X5_5_1$DEPARTAMENTO= gsub("Región Lima","Provincias de Lima",X5_5_1$DEPARTAMENTO)
#X5_5_1$DEPARTAMENTO= gsub("Nacional","Total",X5_5_1$DEPARTAMENTO)
```

## 5.5.1.b --> 5.5.2 Proporción de alcaldías dirigidas por mujeres por período de alcaldía
```{r, warning=FALSE, message=FALSE}
url <- "https://github.com/ChiaraZamoraM/ODS/raw/main/5.5.1.b.xlsx"
destfile <- "X5_5_1.b.xlsx"
curl::curl_download(url, destfile)
X5_5_2 <- read_excel(destfile, skip = 7)

colnames(X5_5_2) = str_sub(colnames(X5_5_2), start= 1, end=4)

colnames(X5_5_2) = paste0("ODS5_5_2_",colnames(X5_5_2))
names(X5_5_2)[1]= "DEPARTAMENTO"
```

```{r, warning=FALSE, message=FALSE}
X5_5_2$DEPARTAMENTO= gsub("Prov. Const. del Callao","Callao",X5_5_2$DEPARTAMENTO)
X5_5_2$DEPARTAMENTO= gsub("Provincia de Lima","Lima Metropolitana",X5_5_2$DEPARTAMENTO)
X5_5_2$DEPARTAMENTO= gsub("Región Lima","Provincias de Lima",X5_5_2$DEPARTAMENTO)
X5_5_2$DEPARTAMENTO= gsub("Nacional","Total",X5_5_2$DEPARTAMENTO)
```

## 5.5.1.c --> 5.5.3 Proporción de regidoras mujeres elegidas por período del regidor/a
```{r, warning=FALSE, message=FALSE}
url <- "https://github.com/ChiaraZamoraM/ODS/raw/main/5.5.1.c.xlsx"
destfile <- "X5_5_1.c.xlsx"
curl::curl_download(url, destfile)
X5_5_3 <- read_excel(destfile, skip = 7)

colnames(X5_5_3) = str_sub(colnames(X5_5_3), start= 1, end=4)

colnames(X5_5_3) = paste0("ODS5_5_3_",colnames(X5_5_3))
names(X5_5_3)[1]= "DEPARTAMENTO"
```

```{r, warning=FALSE, message=FALSE}
X5_5_3$DEPARTAMENTO= gsub("Prov. Const. del Callao","Callao",X5_5_3$DEPARTAMENTO)
X5_5_3$DEPARTAMENTO= gsub("Provincia de Lima","Lima Metropolitana",X5_5_3$DEPARTAMENTO)
X5_5_3$DEPARTAMENTO= gsub("Región Lima","Provincias de Lima",X5_5_3$DEPARTAMENTO)
X5_5_3$DEPARTAMENTO= gsub("Nacional","Total",X5_5_3$DEPARTAMENTO)
X5_5_3$DEPARTAMENTO= gsub("Resto país","Resto País",X5_5_3$DEPARTAMENTO)
```

## 5.5.2 --> 5.5.4 Proporción de mujeres en cargos directivos
```{r, warning=FALSE, message=FALSE}
url <- "https://github.com/ChiaraZamoraM/ODS/raw/main/5.5.2.xlsx"
destfile <- "X5_5_2.xlsx"
curl::curl_download(url, destfile)
X5_5_4 <- read_excel(destfile, skip = 7)

#colnames(X5_5_4) = str_sub(colnames(X5_5_4), start= 1, end=4)

colnames(X5_5_4) = paste0("ODS5_5_4_",colnames(X5_5_4))
names(X5_5_4)[1]= "DEPARTAMENTO"
```

```{r, warning=FALSE, message=FALSE}
X5_5_4$DEPARTAMENTO= gsub("Nacional","Total",X5_5_4$DEPARTAMENTO)
X5_5_4$DEPARTAMENTO= gsub("Resto país","Resto País",X5_5_4$DEPARTAMENTO)

```

## 5.a.1 Proporción del total de la población agrícola con derechos de propiedad o derechos seguros sobre las tierras agrícolas, desglosada por sexo

## 5.b.1 Proporción de personas de 15 a más años de edad que poseen un teléfono móvil, desglosada por sexo

## Merge ODS 5
```{r, warning=FALSE, message=FALSE}
ODS_5 = Reduce(function(x, y) merge(x, y, by= "DEPARTAMENTO",all=TRUE), list(X5_2_1,                                                                           X5_5_2,X5_5_3,
                                                                             X5_5_4))

ODS_5=ODS_5[rowSums(is.na(ODS_5)) != ncol(ODS_5)-1,]
ODS_5=ODS_5[rowSums(is.na(ODS_5)) != ncol(ODS_5),]
```


# ODS 6

## 6.1.1 Proporción de la población que dispone de agua por red pública
```{r, warning=FALSE, message=FALSE}
X6_1_1 <- import("https://www.inei.gob.pe/media/MenuRecursivo/publicaciones_digitales/Est/Lib1829/cap04/cap04013.xlsx")
names(X6_1_1) <- as.character(X6_1_1[3,])
X6_1_1 = X6_1_1[-c(1:4,37:44),]
colnames(X6_1_1) = paste0("ODS6_1_1_",colnames(X6_1_1))
names(X6_1_1)[1]= "DEPARTAMENTO"

X6_1_1$DEPARTAMENTO= gsub("Lima 2/","Provincias de Lima",X6_1_1$DEPARTAMENTO)

X6_1_1$DEPARTAMENTO =gsub(' [0-9].', '', X6_1_1$DEPARTAMENTO)
```

```{r, warning=FALSE, message=FALSE}
X6_1_1$DEPARTAMENTO= gsub("Prov. Const. del Callao","Callao",X6_1_1$DEPARTAMENTO)
#X4_6_1$DEPARTAMENTO= gsub("Lima Metropolitana","LIMA",X4_6_1$DEPARTAMENTO)
```

## 6.2.1 Proporción de la población que utiliza servicios de saneamiento gestionados sin riesgos
```{r, warning=FALSE, message=FALSE}
url <- "https://github.com/ChiaraZamoraM/ODS/raw/main/6.2.1.xlsx"
destfile <- "X6_2_1.xlsx"
curl::curl_download(url, destfile)
X6_2_1 <- read_excel(destfile, skip = 7)

colnames(X6_2_1) = paste0("ODS6_2_1_",colnames(X6_2_1))
names(X6_2_1)[1]= "DEPARTAMENTO"
```

```{r, warning=FALSE, message=FALSE}
X6_2_1$DEPARTAMENTO= gsub("Prov. Const. del Callao","Callao",X6_2_1$DEPARTAMENTO)
X6_2_1$DEPARTAMENTO= gsub("Resto país","Resto País",X6_2_1$DEPARTAMENTO)
X6_2_1$DEPARTAMENTO= gsub("Región Lima","Provincias de Lima",X6_2_1$DEPARTAMENTO)
X6_2_1$DEPARTAMENTO= gsub("Nacional","Total",X6_2_1$DEPARTAMENTO)

```

## 6.3.1 Proporción de hogares con agua tratada

## Merge ODS 6
```{r, warning=FALSE, message=FALSE}
ODS_6 = Reduce(function(x, y) merge(x, y, by= "DEPARTAMENTO",all=TRUE), list(X6_1_1,X6_2_1))

ODS_6=ODS_6[rowSums(is.na(ODS_6)) != ncol(ODS_6)-1,]
ODS_6=ODS_6[rowSums(is.na(ODS_6)) != ncol(ODS_6),]
```

# ODS 7

## 7.1.1 Proporción de la población que tiene acceso a la electricidad
```{r, warning=FALSE, message=FALSE}
url <- "https://github.com/ChiaraZamoraM/ODS/raw/main/7.1.1.xlsx"
destfile <- "X7_1_1.xlsx"
curl::curl_download(url, destfile)
X7_1_1 <- read_excel(destfile, skip = 7)

colnames(X7_1_1) = paste0("ODS7_1_1_",colnames(X7_1_1))
names(X7_1_1)[1]= "DEPARTAMENTO"
```

```{r, warning=FALSE, message=FALSE}
X7_1_1$DEPARTAMENTO= gsub("Prov. Const. del Callao","Callao",X7_1_1$DEPARTAMENTO)
X7_1_1$DEPARTAMENTO= gsub("Resto país","Resto País",X7_1_1$DEPARTAMENTO)
X7_1_1$DEPARTAMENTO= gsub("Región Lima","Provincias de Lima",X7_1_1$DEPARTAMENTO)
X7_1_1$DEPARTAMENTO= gsub("Nacional","Total",X7_1_1$DEPARTAMENTO)
```

```{r, warning=FALSE, message=FALSE}
X7_1_1_R <- import("https://www.inei.gob.pe/media/MenuRecursivo/publicaciones_digitales/Est/Lib1829/cap17/cap17013.xls")
names(X7_1_1_R) <- as.character(X7_1_1_R[3,])
X7_1_1_R = X7_1_1_R[,-c(2:21,23,24)]
colnames(X7_1_1_R) = paste0("ODS7_1_1_",colnames(X7_1_1_R))
names(X7_1_1_R)[1]= "DEPARTAMENTO"


X7_1_1_R$DEPARTAMENTO= gsub("Provincia de Lima 1/","Lima Metropolitana",X7_1_1_R$DEPARTAMENTO)
X7_1_1_R$DEPARTAMENTO= gsub("Región Lima  2/","Provincias de Lima",X7_1_1_R$DEPARTAMENTO)
X7_1_1_R$DEPARTAMENTO= gsub("Total Nacional","Total",X7_1_1_R$DEPARTAMENTO)
```

```{r}
X7_1_1= merge(X7_1_1, X7_1_1_R, by= "DEPARTAMENTO", all = TRUE)
X7_1_1=X7_1_1[rowSums(is.na(X7_1_1)) != ncol(X7_1_1)-1,]
X7_1_1=X7_1_1[rowSums(is.na(X7_1_1)) != ncol(X7_1_1),]
```

## 7.1.2 Proporción de la población cuya fuente primaria de energía para cocinar consiste en combustibles y tecnología limpios

```{r, warning=FALSE, message=FALSE}
url <- "https://github.com/ChiaraZamoraM/ODS/raw/main/7.1.2.xlsx"
destfile <- "X7_1_2.xlsx"
curl::curl_download(url, destfile)
X7_1_2 <- read_excel(destfile, skip = 7)

colnames(X7_1_2) = paste0("ODS7_1_2_",colnames(X7_1_2))
names(X7_1_2)[1]= "DEPARTAMENTO"
```

```{r, warning=FALSE, message=FALSE}
X7_1_2$DEPARTAMENTO= gsub("Prov. Const. del Callao","Callao",X7_1_2$DEPARTAMENTO)
X7_1_2$DEPARTAMENTO= gsub("Resto país","Resto País",X7_1_2$DEPARTAMENTO)
X7_1_2$DEPARTAMENTO= gsub("Región Lima","Provincias de Lima",X7_1_2$DEPARTAMENTO)
X7_1_2$DEPARTAMENTO= gsub("Nacional","Total",X7_1_2$DEPARTAMENTO)
```

## Merge ODS 7
```{r, warning=FALSE, message=FALSE}
ODS_7 = Reduce(function(x, y) merge(x, y, by= "DEPARTAMENTO",all=TRUE), list(X7_1_1,X7_1_2))

ODS_7=ODS_7[rowSums(is.na(ODS_7)) != ncol(ODS_7)-1,]
ODS_7=ODS_7[rowSums(is.na(ODS_7)) != ncol(ODS_7),]
```

# ODS 8

## 8.1.1 Tasa de crecimiento anual del PBI real per cápita
```{r, warning=FALSE, message=FALSE}
url <- "https://github.com/ChiaraZamoraM/ODS/raw/main/ODS%208-9-10/8.1.1.xlsx"
destfile <- "X8_1_1.xlsx"
curl::curl_download(url, destfile)
X8_1_1 <- read_excel(destfile, skip = 7)

colnames(X8_1_1) = paste0("ODS8_1_1_",colnames(X8_1_1))
names(X8_1_1)[1]= "DEPARTAMENTO"
```

```{r, warning=FALSE, message=FALSE}
X8_1_1$DEPARTAMENTO= gsub("Nacional","Total",X8_1_1$DEPARTAMENTO)
```


## 8.2.1 Tasa de crecimiento anual del PBI real por persona empleada
```{r, warning=FALSE, message=FALSE}
url <- "https://github.com/ChiaraZamoraM/ODS/raw/main/ODS%208-9-10/8.2.1.xlsx"
destfile <- "X8_2_1.xlsx"
curl::curl_download(url, destfile)
X8_2_1 <- read_excel(destfile, skip = 7)

colnames(X8_2_1) = paste0("ODS8_2_1_",colnames(X8_2_1))
names(X8_2_1)[1]= "DEPARTAMENTO"
```

```{r, warning=FALSE, message=FALSE}
X8_2_1$DEPARTAMENTO= gsub("Nacional","Total",X8_2_1$DEPARTAMENTO)
```


## 8.3.1 Proporción de la población con empleo informal -en el sector no agrícola-

```{r, warning=FALSE, message=FALSE}
X8_3_1 <- import("https://www.inei.gob.pe/media/MenuRecursivo/publicaciones_digitales/Est/Lib1829/cap07/cap07043.xlsx")
names(X8_3_1) <- as.character(X8_3_1[2,])
X8_3_1 = X8_3_1[-c(1:3,43:46),]
colnames(X8_3_1) = paste0("ODS8_3_1_",colnames(X8_3_1))
names(X8_3_1)[1]= "DEPARTAMENTO"

X8_3_1$DEPARTAMENTO =gsub(' [0-9].', '', X8_3_1$DEPARTAMENTO)
```

```{r}
X8_3_1$DEPARTAMENTO= gsub("Prov. Const. del Callao","Callao",X8_3_1$DEPARTAMENTO)
X8_3_1[29,1]= "Provincias de Lima"
```

```{r, warning=FALSE, message=FALSE}
X8_3_1=X8_3_1[rowSums(is.na(X8_3_1)) != ncol(X8_3_1)-1,]
X8_3_1=X8_3_1[rowSums(is.na(X8_3_1)) != ncol(X8_3_1),]
```

## 8.5.1 Ingreso medio por hora [MENSUAL] de empleadas y empleados

```{r, warning=FALSE, message=FALSE}
url <- "https://github.com/ChiaraZamoraM/ODS/raw/main/ODS%208-9-10/8.5.1.xlsx"
destfile <- "X8_5_1.xlsx"
curl::curl_download(url, destfile)
X8_5_1 <- read_excel(destfile, skip = 7)

colnames(X8_5_1) = paste0("ODS8_5_1_",colnames(X8_5_1))
names(X8_5_1)[1]= "DEPARTAMENTO"
```

```{r, warning=FALSE, message=FALSE}
X8_5_1$DEPARTAMENTO= gsub("Prov. Const. del Callao","Callao",X8_5_1$DEPARTAMENTO)
X8_5_1$DEPARTAMENTO= gsub("Provincia de Lima","Lima Metropolitana",X8_5_1$DEPARTAMENTO)
X8_5_1$DEPARTAMENTO= gsub("Región Lima","Provincias de Lima",X8_5_1$DEPARTAMENTO)
X8_5_1$DEPARTAMENTO= gsub("Nacional","Total",X8_5_1$DEPARTAMENTO)
X8_5_1$DEPARTAMENTO= gsub("Resto país","Resto País",X8_5_1$DEPARTAMENTO)
```

- Ingreso medio mensual
```{r, warning=FALSE, message=FALSE}
#X8_5_1 <- import("https://www.inei.gob.pe/media/MenuRecursivo/publicaciones_digitales/Est/Lib1829/cap07/cap07055.xlsx")
#names(X8_5_1) <- as.character(X8_5_1[4,])
#X8_5_1 = X8_5_1[-c(1:6,46:49),]
#colnames(X8_5_1) = paste0("ODS8_5_1_",colnames(X8_5_1))
#names(X8_5_1)[1]= "DEPARTAMENTO"

#X8_5_1$DEPARTAMENTO= gsub("Lima 2/","Provincias de Lima",X8_5_1$DEPARTAMENTO)

#X8_5_1$DEPARTAMENTO =gsub(' [0-9].', '', X8_5_1$DEPARTAMENTO)
```

```{r}
#X8_5_1$DEPARTAMENTO= gsub("Prov. Const. del Callao","Callao",X8_5_1$DEPARTAMENTO)
X8_5_1=X8_5_1[rowSums(is.na(X8_5_1)) != ncol(X8_5_1)-1,]
X8_5_1=X8_5_1[rowSums(is.na(X8_5_1)) != ncol(X8_5_1),]
```

## 8.5.2 Tasa de desempleo en el área urbana
```{r, warning=FALSE, message=FALSE}
url <- "https://github.com/ChiaraZamoraM/ODS/raw/main/ODS%208-9-10/8.5.2.xlsx"
destfile <- "X8_5_2.xlsx"
curl::curl_download(url, destfile)
X8_5_2 <- read_excel(destfile, skip = 7)

colnames(X8_5_2) = paste0("ODS8_5_2_",colnames(X8_5_2))
names(X8_5_2)[1]= "DEPARTAMENTO"
```

```{r, warning=FALSE, message=FALSE}
X8_5_2$DEPARTAMENTO= gsub("Nacional","Total", X8_5_2$DEPARTAMENTO)
X8_5_2$DEPARTAMENTO= gsub("Resto país","Resto País", X8_5_2$DEPARTAMENTO)

```

```{r}
X8_5_2_A <- import("https://www.inei.gob.pe/media/MenuRecursivo/publicaciones_digitales/Est/Lib1829/cap07/cap07054.xlsx")
names(X8_5_2_A) <- as.character(X8_5_2_A[3,])
X8_5_2_A = X8_5_2_A[-c(1:4),-c(2:14)]
colnames(X8_5_2_A) = paste0("ODS8_5_2_",colnames(X8_5_2_A))
names(X8_5_2_A)[1]= "DEPARTAMENTO"

X8_5_2 = merge(X8_5_2, X8_5_2_A, by= "DEPARTAMENTO", all = TRUE)

X8_5_2=X8_5_2[rowSums(is.na(X8_5_2)) != ncol(X8_5_2)-1,]
X8_5_2=X8_5_2[rowSums(is.na(X8_5_2)) != ncol(X8_5_2),]
```

## 8.6.1 Proporción de jóvenes (entre 15 y 24 años) que no cursan estudios, no están empleados ni reciben capacitación
```{r, warning=FALSE, message=FALSE}
url <- "https://github.com/ChiaraZamoraM/ODS/raw/main/ODS%208-9-10/8.6.1.xlsx"
destfile <- "X8_6_1.xlsx"
curl::curl_download(url, destfile)
X8_6_1 <- read_excel(destfile, skip = 7)

colnames(X8_6_1) = paste0("ODS8_6_1_",colnames(X8_6_1))
names(X8_6_1)[1]= "DEPARTAMENTO"
```

```{r, warning=FALSE, message=FALSE}
X8_6_1$DEPARTAMENTO= gsub("Prov. Const. del Callao","Callao",X8_6_1$DEPARTAMENTO)
#X8_6_1$DEPARTAMENTO= gsub("Provincia de Lima","Lima Metropolitana",X8_6_1$DEPARTAMENTO)
X8_6_1$DEPARTAMENTO= gsub("Región Lima","Provincias de Lima",X8_6_1$DEPARTAMENTO)
X8_6_1$DEPARTAMENTO= gsub("Nacional","Total",X8_6_1$DEPARTAMENTO)
X8_6_1$DEPARTAMENTO= gsub("Resto país","Resto País",X8_6_1$DEPARTAMENTO)
```


## 8.7.1 Proporción de niños, niñas y adolescentes de 5 a 17 años en actividad económica
```{r, warning=FALSE, message=FALSE}
url <- "https://github.com/ChiaraZamoraM/ODS/raw/main/ODS%208-9-10/8.7.1.xlsx"
destfile <- "X8_7_1.xlsx"
curl::curl_download(url, destfile)
X8_7_1 <- read_excel(destfile, skip = 7)

colnames(X8_7_1) = paste0("ODS8_7_1_",colnames(X8_7_1))
names(X8_7_1)[1]= "DEPARTAMENTO"
```

```{r, warning=FALSE, message=FALSE}
X8_7_1$DEPARTAMENTO= gsub("Prov. Const. del Callao","Callao",X8_7_1$DEPARTAMENTO)
X8_7_1$DEPARTAMENTO= gsub("Provincia de Lima","Lima Metropolitana",X8_7_1$DEPARTAMENTO)
X8_7_1$DEPARTAMENTO= gsub("Región Lima","Provincias de Lima",X8_7_1$DEPARTAMENTO)
X8_7_1$DEPARTAMENTO= gsub("Nacional","Total",X8_7_1$DEPARTAMENTO)
```

## Merge ODS 8
```{r, warning=FALSE, message=FALSE}
ODS_8 = Reduce(function(x, y) merge(x, y, by= "DEPARTAMENTO",all=TRUE), list(X8_1_1,X8_2_1,
                                                                             X8_5_1,X8_5_2,
                                                                             X8_6_1,X8_7_1))

ODS_8=ODS_8[rowSums(is.na(ODS_8)) != ncol(ODS_8)-1,]
ODS_8=ODS_8[rowSums(is.na(ODS_8)) != ncol(ODS_8),]
```

## 9.2.2 Empleo del sector manufacturero en proporción al empleo total
```{r, warning=FALSE, message=FALSE}
url <- "https://github.com/ChiaraZamoraM/ODS/raw/main/ODS%208-9-10/9.2.2.xlsx"
destfile <- "X9_2_2.xlsx"
curl::curl_download(url, destfile)
X9_2_2 <- read_excel(destfile, skip = 7)

colnames(X9_2_2) = paste0("ODS9_2_2_",colnames(X9_2_2))
names(X9_2_2)[1]= "DEPARTAMENTO"
```

```{r, warning=FALSE, message=FALSE}
X9_2_2$DEPARTAMENTO= gsub("Prov. Const. del Callao","Callao",X9_2_2$DEPARTAMENTO)
X9_2_2$DEPARTAMENTO= gsub("Provincia de Lima","Lima Metropolitana",X9_2_2$DEPARTAMENTO)
X9_2_2$DEPARTAMENTO= gsub("Región Lima","Provincias de Lima",X9_2_2$DEPARTAMENTO)
X9_2_2$DEPARTAMENTO= gsub("Nacional","Total",X9_2_2$DEPARTAMENTO)
```

## 10.1.1 Tasa de crecimiento del gasto real promedio per cápita mensual del 40% más pobre de la población
```{r, warning=FALSE, message=FALSE}
url <- "https://github.com/ChiaraZamoraM/ODS/raw/main/ODS%208-9-10/10.1.1.xlsx"
destfile <- "X10_1_1.xlsx"
curl::curl_download(url, destfile)
X10_1_1 <- read_excel(destfile, skip = 7)

colnames(X10_1_1) = paste0("ODS10_1_1_",colnames(X10_1_1))
names(X10_1_1)[1]= "DEPARTAMENTO"
```

```{r, warning=FALSE, message=FALSE}
X10_1_1$DEPARTAMENTO= gsub("Prov. Const. del Callao","Callao",X10_1_1$DEPARTAMENTO)
#X10_1_1$DEPARTAMENTO= gsub("Provincia de Lima","Lima Metropolitana",X10_1_1$DEPARTAMENTO)
X10_1_1$DEPARTAMENTO= gsub("Región Lima","Provincias de Lima",X10_1_1$DEPARTAMENTO)
X10_1_1$DEPARTAMENTO= gsub("Nacional","Total",X10_1_1$DEPARTAMENTO)
```

## 10.2.1 Proporción de personas que viven por debajo del 50% de la mediana de los ingresos
```{r, warning=FALSE, message=FALSE}
url <- "https://github.com/ChiaraZamoraM/ODS/raw/main/ODS%208-9-10/10.2.1.xlsx"
destfile <- "X10_2_1.xlsx"
curl::curl_download(url, destfile)
X10_2_1 <- read_excel(destfile, skip = 7)

colnames(X10_2_1) = paste0("ODS10_2_1_",colnames(X10_2_1))
names(X10_2_1)[1]= "DEPARTAMENTO"
```

```{r, warning=FALSE, message=FALSE}
X10_2_1$DEPARTAMENTO= gsub("Prov. Const. del Callao","Callao",X10_2_1$DEPARTAMENTO)
X10_2_1$DEPARTAMENTO= gsub("Provincia de Lima","Lima Metropolitana",X10_2_1$DEPARTAMENTO)
X10_2_1$DEPARTAMENTO= gsub("Región Lima","Provincias de Lima",X10_2_1$DEPARTAMENTO)
X10_2_1$DEPARTAMENTO= gsub("Nacional","Total",X10_2_1$DEPARTAMENTO)
```


## 10.3.1 Proporción de población de 18 y más años de edad que señalan que en los últimos cinco años se han sentido maltratadas o han intentado discriminarlas
```{r, warning=FALSE, message=FALSE}
url <- "https://github.com/ChiaraZamoraM/ODS/raw/main/ODS%208-9-10/10.3.1.xlsx"
destfile <- "X10_3_1.xlsx"
curl::curl_download(url, destfile)
X10_3_1 <- read_excel(destfile, skip = 7)

colnames(X10_3_1) = paste0("ODS10_3_1_",colnames(X10_3_1))
names(X10_3_1)[1]= "DEPARTAMENTO"
```

```{r, warning=FALSE, message=FALSE}
X10_3_1$DEPARTAMENTO= gsub("Prov. Const. del Callao","Callao",X10_3_1$DEPARTAMENTO)
#X10_3_1$DEPARTAMENTO= gsub("Provincia de Lima","Lima Metropolitana",X10_3_1$DEPARTAMENTO)
X10_3_1$DEPARTAMENTO= gsub("Región Lima","Provincias de Lima",X10_3_1$DEPARTAMENTO)
X10_3_1$DEPARTAMENTO= gsub("Nacional","Total",X10_3_1$DEPARTAMENTO)
X10_3_1$DEPARTAMENTO= gsub("Resto país","Resto País",X10_3_1$DEPARTAMENTO)
```

## Merge ODS 10
```{r, warning=FALSE, message=FALSE}
ODS_10 = Reduce(function(x, y) merge(x, y, by= "DEPARTAMENTO",all=TRUE), list(X10_1_1,X10_2_1, X10_3_1))

ODS_10=ODS_10[rowSums(is.na(ODS_10)) != ncol(ODS_10)-1,]
ODS_10=ODS_10[rowSums(is.na(ODS_10)) != ncol(ODS_10),]
```

# Merge
```{r, warning=FALSE, message=FALSE}
ODS = Reduce(function(x, y) merge(x, y, by= "DEPARTAMENTO",all=TRUE), list(ODS_1,ODS_2, ODS_3, ODS_4, ODS_5, ODS_6, ODS_7, ODS_8, X9_2_2, ODS_10))

ODS=ODS[rowSums(is.na(ODS)) != ncol(ODS)-1,]
ODS=ODS[rowSums(is.na(ODS)) != ncol(ODS)-2,]
ODS=ODS[rowSums(is.na(ODS)) != ncol(ODS)-3,]
ODS=ODS[rowSums(is.na(ODS)) != ncol(ODS)-4,]
ODS=ODS[rowSums(is.na(ODS)) != ncol(ODS)-9,]
ODS=ODS[ODS$DEPARTAMENTO != "Hombre" &
          ODS$DEPARTAMENTO != "Mujer" &
          ODS$DEPARTAMENTO != "Estatal"&
          ODS$DEPARTAMENTO != "No Estatal"
        ,]
ODS=ODS[rowSums(is.na(ODS)) != ncol(ODS),]

#ODS$DEPARTAMENTO= stri_trans_general(str = toupper(ODS$DEPARTAMENTO), id = "Latin-ASCII")

ODS= ODS[!is.na(ODS$DEPARTAMENTO),]
```

```{r, warning=FALSE, message=FALSE}
ODSTrans= ODS %>% gather( ODS_Ano, Valor, 2:ncol(ODS), na.rm = TRUE, convert = FALSE)
```

```{r, warning=FALSE, message=FALSE}
ODSTrans$Ano= sub('.*(\\d{4}).*', '\\1', ODSTrans$ODS_Ano)

#ODSTrans$Ano = as.Date(as.character(ODSTrans$Ano), format = "%Y")
#ODSTrans$Ano<- year(ODSTrans$Ano)

ODSTrans$ODSNro= str_extract(ODSTrans$ODS_Ano,'\\d_\\w_\\d')

ODSTrans$ODSNro= gsub('_','.',ODSTrans$ODSNro)

ODSTrans$Valor= sapply(ODSTrans$Valor,as.numeric)

ODSTrans$Valor= round(ODSTrans$Valor,1)

ODSTrans= ODSTrans[,-2]
```

```{r, warning=FALSE, message=FALSE}
#set = subset(ODSTrans, Ano> 2014)
#names(set)
#ODSSpr= set %>% spread(ODSNro, Valor)

ODSSpr = ODSTrans %>%
  pivot_wider(names_from = ODSNro,
              values_from = Valor)

names(ODSSpr)[c(3:ncol(ODSSpr))]= paste("ODS", names(ODSSpr)[c(3:ncol(ODSSpr))])

colnames(ODSSpr)[2] ="Year"

ODSSpr$DEPARTAMENTO= gsub("Provincias de Lima","LIMA PROVINCIAS",ODSSpr$DEPARTAMENTO)
ODSSpr$DEPARTAMENTO= gsub("Lima Metropolitana","LIMA",ODSSpr$DEPARTAMENTO)
ODSSpr$DEPARTAMENTO= gsub("Lima","Departamento de Lima",ODSSpr$DEPARTAMENTO)

ODSSpr$DEPARTAMENTO= stri_trans_general(str = toupper(ODSSpr$DEPARTAMENTO), 
                                        id = "Latin-ASCII")

#ODSShiny = ODSSpr

#ODSShiny$Ano = year(ODSShiny$Ano)
```

```{r}
#saveRDS(ODSShiny, "ODSShinySinGeom.RDS")
```

```{r, warning=FALSE, message=FALSE}
#ODSShiny$DEPARTAMENTO= gsub("Provincias de Lima","LIMA PROVINCIAS",ODSShiny$DEPARTAMENTO)
#ODSShiny$DEPARTAMENTO= gsub("Lima Metropolitana","LIMA",ODSShiny$DEPARTAMENTO)
#ODSShiny$DEPARTAMENTO= gsub("Lima","Departamento de Lima",ODSShiny$DEPARTAMENTO)

#ODSShiny$DEPARTAMENTO= stri_trans_general(str = toupper(ODSShiny$DEPARTAMENTO), id = "Latin-ASCII")
```

```{r}
#download.file("https://github.com/ChiaraZamoraM/ODS/raw/main/Departamentos_Peru/mapa_depas_Lima.zip"#, 
 #             destfile = "mapa_depas_Lima.zip" , mode='wb')
#unzip("mapa_depas_Lima.zip", exdir = ".")
#file.remove("mapa_depas_Lima.zip")

# mapa = st_read("mapa_depas_Lima.shp")

#ODSShiny$DEPARTAMENTO= stri_trans_general(str = toupper(ODSShiny$DEPARTAMENTO), id = "Latin-ASCII")
```

```{r, warning=FALSE, message=FALSE}
#ODS1_1_1 = ODSSpr[-c(4:ncol(ODSSpr)),]

#ODS1_1_1 = ODSSpr[,-c(4:ncol(ODSSpr))]
#ODS1_1_1 = ODS1_1_1 %>%
 # pivot_wider(names_from = DEPARTAMENTO,
  #          values_from = '1.1.1')
```

```{r, warning=FALSE, message=FALSE}
#ODSShiny = merge(mapa, ODSShiny,
             #   by.x='DEPARTAMEN',by.y="DEPARTAMENTO")

#ODSShiny = subset(ODSShiny, Ano> 2014)
#saveRDS(ODSShiny, "ODSShiny.RDS")
```

```{r, warning=FALSE, message=FALSE}
saveRDS(ODSSpr, "BASE_ODS.RDS")
```

```{r, warning=FALSE, message=FALSE}
#library(xlsx)
#saveWorkbook(ODSSpr, "Base_ODS.xlsx")
```

```{r, warning=FALSE, message=FALSE}
write.csv(ODSSpr,"BASE_ODS.csv")
```
